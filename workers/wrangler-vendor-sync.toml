name = "vendor-sync-worker"
main = "vendor-sync-worker.js"
compatibility_date = "2023-12-01"
account_id = "928f2a6b07f166d57bb4b31b9100d1f4"

[[d1_databases]]
binding = "DB"
database_name = "autopret123"
database_id = "a6a6d62b-39d9-4aae-b505-21475763bac0"

# Service binding to lambert-scraper worker
[[services]]
binding = "LAMBERT_SCRAPER"
service = "lambert-scraper"

# Service binding to NaniAuto scraper
[[services]]
binding = "NANIAUTO_SCRAPER"
service = "naniauto-scraper"

# Service binding to SLT Autos scraper
[[services]]
binding = "SLTAUTOS_SCRAPER"
service = "sltautos-scraper"

# Service binding to generic dealer scraper (fallback)
[[services]]
binding = "GENERIC_DEALER_SCRAPER"
service = "generic-dealer-scraper"

[vars]
ENVIRONMENT = "production"
CLOUDFLARE_ACCOUNT_ID = "928f2a6b07f166d57bb4b31b9100d1f4"

# Scheduled automatic syncing - Each vendor runs at a different time
# This prevents overloading the system and allows better monitoring
[triggers]
crons = [
  "0 1 * * *",  # Lambert Auto lifecycle at 1 AM UTC
  "0 2 * * *",  # NaniAuto lifecycle at 2 AM UTC
  "0 3 * * *"   # SLT Autos lifecycle at 3 AM UTC
]

# To set the Cloudflare Images API token, run:
# npx wrangler secret put CLOUDFLARE_IMAGES_TOKEN --config workers/wrangler-vendor-sync.toml
# Then paste your Cloudflare Images API token when prompted
